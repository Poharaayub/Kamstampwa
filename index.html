<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kamstampwa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%);
            background-attachment: fixed;
            min-height: 100vh;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 24px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
        }

        .glass-input {
            background: rgba(255, 255, 255, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 14px;
            color: #1e3a8a;
            transition: all 0.3s ease;
        }

        .glass-button-submit {
            background: rgba(59, 130, 246, 0.2);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(59, 130, 246, 0.4);
            color: #1e40af;
            border-radius: 50px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
            transition: all 0.3s ease;
        }

        .glass-button-submit:hover:not(:disabled) {
            background: rgba(59, 130, 246, 0.3);
            transform: translateY(-2px);
        }

        .photo-container {
            position: relative;
            border-radius: 18px;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.6);
            aspect-ratio: 1/1;
            background: rgba(255, 255, 255, 0.2);
        }

        .loader {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .blob {
            position: fixed;
            z-index: -1;
            filter: blur(40px);
            border-radius: 50%;
            opacity: 0.6;
        }
    </style>
</head>
<body class="pb-40">
    <div class="blob bg-blue-300 w-64 h-64 -top-20 -left-20 animate-pulse"></div>
    <div class="blob bg-purple-200 w-96 h-96 -bottom-32 -right-32"></div>

    <header class="p-8">
        <div class="flex flex-col items-center text-center space-y-3">
            <div class="glass-card p-5 text-blue-600 shadow-lg">
                <svg class="w-10 h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg>
            </div>
            <div>
                <h1 class="text-2xl font-extrabold text-blue-900 tracking-tight">Kamstampwa</h1>
                <p class="text-xs font-semibold text-blue-700 uppercase tracking-widest opacity-70">By Pohara Ayub</p>
            </div>
        </div>
    </header>

    <main class="px-5 space-y-6 max-w-md mx-auto">
        <section class="glass-card p-6 space-y-5">
            <div class="flex justify-between items-center">
                <h2 class="text-xs font-bold text-blue-900 uppercase tracking-widest opacity-60">Dokumentasi Kamera</h2>
                <div class="flex items-center space-x-2">
                    <button onclick="clearAllPhotos()" id="btnClearAll" class="hidden text-[10px] font-bold text-red-600 bg-white/50 backdrop-blur-sm px-3 py-1.5 rounded-full uppercase border border-red-100">Hapus Semua</button>
                    <span id="photoCount" class="bg-blue-600 text-white text-[10px] font-black px-3 py-1.5 rounded-full shadow-md">0</span>
                </div>
            </div>

            <label class="flex flex-col items-center justify-center py-12 glass-input cursor-pointer hover:bg-white/40 active:scale-95 transition-all">
                <svg class="w-12 h-12 text-blue-600 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg>
                <span class="text-[11px] font-black text-blue-800 uppercase tracking-[0.2em]">Ambil Foto</span>
                <input type="file" id="cameraInput" accept="image/*" capture="environment" class="hidden">
            </label>

            <div id="loadingOverlay" class="hidden flex items-center justify-center p-4 bg-white/30 backdrop-blur rounded-2xl border border-white/50">
                <span class="loader mr-3"></span>
                <span id="loadingMsg" class="text-[10px] font-bold text-blue-900 uppercase tracking-widest">Memproses...</span>
            </div>

            <div id="photoGrid" class="grid grid-cols-3 gap-3"></div>
        </section>
    </main>

    <div class="fixed bottom-0 left-0 right-0 p-8 flex justify-center pointer-events-none z-50">
        <button onclick="sharePhotos()" id="btnSubmit" class="glass-button-submit pointer-events-auto px-10 py-5 flex items-center space-x-3 max-w-xs w-full justify-center">
            <span id="btnIcon">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path></svg>
            </span>
            <span id="btnText" class="font-extrabold text-xs tracking-[0.2em] uppercase">Bagikan Foto</span>
        </button>
    </div>

    <script>
        const cameraInput = document.getElementById('cameraInput');
        const photoGrid = document.getElementById('photoGrid');
        const photoCountDisplay = document.getElementById('photoCount');
        const btnClearAll = document.getElementById('btnClearAll');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const loadingMsg = document.getElementById('loadingMsg');
        
        const days = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
        const months = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];

        let capturedPhotos = [];

        cameraInput.addEventListener('change', async (e) => {
            const files = Array.from(e.target.files);
            if (files.length === 0) return;

            const btnSubmit = document.getElementById('btnSubmit');
            btnSubmit.disabled = true;
            loadingOverlay.classList.remove('hidden');

            for (let i = 0; i < files.length; i++) {
                loadingMsg.innerText = `PROSES ${i + 1}/${files.length}`;
                await processImage(files[i]);
            }
            
            e.target.value = '';
            updatePhotoCount();
            btnSubmit.disabled = false;
            loadingOverlay.classList.add('hidden');
        });

        function updatePhotoCount() {
            photoCountDisplay.innerText = capturedPhotos.length;
            if (capturedPhotos.length > 0) {
                btnClearAll.classList.remove('hidden');
            } else {
                btnClearAll.classList.add('hidden');
            }
        }

        function clearAllPhotos() {
            if (capturedPhotos.length === 0) return;
            if (confirm(`Hapus semua (${capturedPhotos.length}) foto?`)) {
                capturedPhotos = [];
                photoGrid.innerHTML = '';
                updatePhotoCount();
            }
        }

        function processImage(file) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = (event) => {
                    const img = new Image();
                    img.onload = () => {
                        const MAX_SIZE = 1200; 
                        let width = img.width;
                        let height = img.height;

                        if (width > height) {
                            if (width > MAX_SIZE) { height *= MAX_SIZE / width; width = MAX_SIZE; }
                        } else {
                            if (height > MAX_SIZE) { width *= MAX_SIZE / height; height = MAX_SIZE; }
                        }

                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        canvas.width = width;
                        canvas.height = height;
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        const now = new Date();
                        const stampText = `${days[now.getDay()]}, ${now.getDate()} ${months[now.getMonth()]} ${now.getFullYear()} ${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;

                        const fontSize = Math.floor(width / 25);
                        ctx.font = `bold ${fontSize}px 'Plus Jakarta Sans', sans-serif`;
                        ctx.fillStyle = "#00ff00";
                        ctx.textAlign = "center";
                        ctx.strokeStyle = "black";
                        ctx.lineWidth = Math.floor(fontSize / 6);
                        ctx.strokeText(stampText, width / 2, height - (fontSize * 1));
                        ctx.fillText(stampText, width / 2, height - (fontSize * 1));
                        
                        canvas.toBlob((blob) => {
                            const stampedDataUrl = canvas.toDataURL('image/jpeg', 0.8);
                            const photoId = 'photo-' + Date.now() + '-' + Math.random().toString(36).substr(2, 5);
                            
                            capturedPhotos.push({ id: photoId, blob: blob, dataUrl: stampedDataUrl });
                            
                            const div = document.createElement('div');
                            div.className = 'photo-container shadow-md';
                            div.id = photoId;
                            div.innerHTML = `
                                <img src="${stampedDataUrl}" class="w-full h-full object-cover">
                                <button onclick="removePhoto('${photoId}')" class="absolute top-1.5 right-1.5 bg-red-500/80 backdrop-blur-sm text-white rounded-lg w-6 h-6 flex items-center justify-center text-[12px] font-bold">Ã—</button>
                            `;
                            
                            photoGrid.appendChild(div);
                            resolve();
                        }, 'image/jpeg', 0.8);
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            });
        }

        window.removePhoto = function(photoId) {
            const index = capturedPhotos.findIndex(p => p.id === photoId);
            if (index !== -1) {
                capturedPhotos.splice(index, 1);
                const el = document.getElementById(photoId);
                if (el) el.remove();
                updatePhotoCount();
            }
        };

        async function sharePhotos() {
            if (capturedPhotos.length === 0) return alert("Ambil foto terlebih dahulu!");

            const btn = document.getElementById('btnSubmit');
            const now = new Date();
            const dateStr = `${now.getDate()}-${months[now.getMonth()]}-${now.getFullYear()}`;
            const timeStr = `${now.getHours().toString().padStart(2, '0')}${now.getMinutes().toString().padStart(2, '0')}`;

            btn.disabled = true;
            const originalBtnText = document.getElementById('btnText').innerText;
            document.getElementById('btnText').innerText = "BERBAGI...";

            try {
                const filesToShare = capturedPhotos.map((p, index) => {
                    return new File([p.blob], `OCS_${dateStr}_${timeStr}_${index + 1}.jpg`, { type: 'image/jpeg' });
                });

                if (navigator.canShare && navigator.canShare({ files: filesToShare })) {
                    // Menghapus 'text' agar tidak muncul keterangan tambahan saat berbagi
                    await navigator.share({
                        files: filesToShare
                    });
                } else {
                    alert("Fitur Share tidak didukung. Foto akan diunduh.");
                    filesToShare.forEach(file => {
                        const url = URL.createObjectURL(file);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = file.name;
                        a.click();
                        URL.revokeObjectURL(url);
                    });
                }
            } catch (err) {
                console.error(err);
                if (err.name !== 'AbortError') alert("Gagal membagikan foto.");
            } finally {
                btn.disabled = false;
                document.getElementById('btnText').innerText = originalBtnText;
            }
        }
    </script>
</body>
</html>

